[![Banners](./Banner.jpg)](https://github.com/ledienbien-ai/DB-zingmp3-servermusic)

<h1 align="center">M√°y ch·ªß √Çm nh·∫°c DB Zing MP3 Xiaozhi </h1>

<p align="center">
D·ª± √°n n√†y d·ª±a tr√™n l√Ω thuy·∫øt v√† c√¥ng ngh·ªá tr√≠ tu·ªá c·ªông sinh ng∆∞·ªùi-m√°y ƒë·ªÉ ph√°t tri·ªÉn h·ªá th·ªëng ph·∫ßn m·ªÅm v√† ph·∫ßn c·ª©ng thi·∫øt b·ªã ƒë·∫ßu cu·ªëi th√¥ng minh<br/>Cung c·∫•p d·ªãch v·ª• backend cho d·ª± √°n ph·∫ßn c·ª©ng th√¥ng minh m√£ ngu·ªìn m·ªü
<a href="https://github.com/78/xiaozhi-esp32">xiaozhi-esp32</a> v√† <a href="https://github.com/TienHuyIoT/xiaozhi-esp32_vietnam">Xiaozhi Iot VN</a> <br/>
ƒê∆∞·ª£c tri·ªÉn khai b·∫±ng Python, Script, Node.
</p>

<p align="center">
<a href="./README.md">H∆∞·ªõng d·∫´n tri·ªÉn khai</a>
¬∑ <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic/issues">B√°o c√°o v·∫•n ƒë·ªÅ</a>
¬∑ <a href="./README.md">T√†i li·ªáu tri·ªÉn khai</a>
¬∑ <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic/releases">Nh·∫≠t k√Ω c·∫≠p nh·∫≠t</a>
</p>

<p align="center">
  <a href="./README.md"><img alt="Ti·∫øng Vi·ªát" src="https://img.shields.io/badge/Ti·∫øng Vi·ªát-DBEDFA"></a>
  <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic/releases">
  <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic/LICENSE">
    <img alt="GitHub pull requests" src="https://img.shields.io/badge/license-MIT-white?labelColor=black" />
  </a>
  <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic">
    <img alt="stars" src="https://img.shields.io/github/stars/ledienbien-ai/DB-zingmp3-servermusic?color=ffcb47&labelColor=black" />
  </a>
</p>

<p align="center">
Vibe Codding b·ªüi L√™ ƒêi·ªán Bi√™n - <a href="https://zalo.me/0915468863" target="blank"> Zalo Me </a>- Email: ledienbien@gmail.com - C·ªông ƒë·ªìng Xiaozhi IoT Vn
</p>
<p align="center"> DEMO: <a href="https://zing.ledienbien.edu.vn" target="blank" >https://zing.ledienbien.edu.vn</a>
</p>
---

## I.Ng∆∞·ªùi d√πng ph√π h·ª£p üë•

D·ª± √°n n√†y c·∫ßn ƒë∆∞·ª£c s·ª≠ d·ª•ng c√πng v·ªõi thi·∫øt b·ªã ph·∫ßn c·ª©ng ESP32. N·∫øu b·∫°n ƒë√£ mua ph·∫ßn c·ª©ng li√™n quan ƒë·∫øn ESP32, ƒë√£ th√†nh c√¥ng k·∫øt n·ªëi v·ªõi d·ªãch v·ª• backend do C·ªông ƒë·ªìng Xiaozhi IoT Vn ph√°t tri·ªÉn, v√† mu·ªën x√¢y d·ª±ng d·ªãch v·ª• backend m√°y ch·ªß √¢m nh·∫°c l·∫•y ngu·ªìn t·ª´ Zing Mp3 ri√™ng c·ªßa m√¨nh, th√¨ d·ª± √°n n√†y r·∫•t ph√π h·ª£p v·ªõi b·∫°n.

ƒê√¢y l√† server gi√∫p c√°c b·∫°n t·∫°o link nh·∫°c k·∫øt n·ªëi v√†o wifi config ho·∫∑c g·∫Øn c·ª©ng v√†o firmware thay server g·ªëc ƒë·ªÉ ph√°t nh·∫°c trong "esp32_music.cc"

---

## II.C·∫£nh b√°o ‚ö†Ô∏è

1. D·ª± √°n n√†y l√† ph·∫ßn m·ªÅm m√£ ngu·ªìn m·ªü, ph·∫ßn m·ªÅm n√†y kh√¥ng c√≥ quan h·ªá h·ª£p t√°c th∆∞∆°ng m·∫°i v·ªõi b·∫•t k·ª≥ nh√† cung c·∫•p d·ªãch v·ª• API b√™n th·ª© ba n√†o (bao g·ªìm nh∆∞ng kh√¥ng gi·ªõi h·∫°n ·ªü c√°c n·ªÅn t·∫£ng v.v.), v√† kh√¥ng ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng d·ªãch v·ª• c≈©ng nh∆∞ an to√†n t√†i ch√≠nh c·ªßa h·ªç.
Khuy·∫øn ngh·ªã ng∆∞·ªùi d√πng ∆∞u ti√™n l·ª±a ch·ªçn nh√† cung c·∫•p d·ªãch v·ª• c√≥ gi·∫•y ph√©p kinh doanh li√™n quan v√† ƒë·ªçc k·ªπ th·ªèa thu·∫≠n d·ªãch v·ª• v√† ch√≠nh s√°ch b·∫£o m·∫≠t c·ªßa h·ªç. Ph·∫ßn m·ªÅm n√†y kh√¥ng l∆∞u tr·ªØ b·∫•t k·ª≥ kh√≥a t√†i kho·∫£n n√†o, kh√¥ng tham gia v√†o lu·ªìng ti·ªÅn v√† kh√¥ng ch·ªãu r·ªßi ro m·∫•t ti·ªÅn n·∫°p.

2. Ch·ª©c nƒÉng c·ªßa d·ª± √°n n√†y ch∆∞a ho√†n thi·ªán v√† ch∆∞a qua ƒë√°nh gi√° b·∫£o m·∫≠t m·∫°ng, vui l√≤ng kh√¥ng s·ª≠ d·ª•ng trong m√¥i tr∆∞·ªùng s·∫£n xu·∫•t. N·∫øu b·∫°n tri·ªÉn khai d·ª± √°n n√†y trong m√¥i tr∆∞·ªùng m·∫°ng c√¥ng c·ªông ƒë·ªÉ h·ªçc t·∫≠p, vui l√≤ng th·ª±c hi·ªán c√°c bi·ªán ph√°p b·∫£o v·ªá c·∫ßn thi·∫øt.

---

## III.T√†i li·ªáu tri·ªÉn khai DB Zing MP3 Music Server tr√™n m√°y ch·ªß Armbian:

#### üö© M√¥ t·∫£ v√† khuy·∫øn ngh·ªã c·∫•u h√¨nh
> [!Note]
> D·ª± √°n n√†y y√™u c·∫ßu c·∫•u h√¨nh:
>
> 1. `Mi·ªÖn ph√≠ ho√†n to√†n cho ng∆∞·ªùi m·ªõi`: Ph√π h·ª£p v·ªõi s·ª≠ d·ª•ng nhu c·∫ßu c√° nh√¢n, t·∫•t c·∫£ c√°c th√†nh ph·∫ßn ƒë·ªÅu s·ª≠ d·ª•ng ph∆∞∆°ng √°n mi·ªÖn ph√≠, kh√¥ng c·∫ßn thanh to√°n th√™m.
>
> 2. `C·∫•u h√¨nh m√°y ch·ªß`: M√°y ch·ªß Armbian c√≥ c·∫•u h√¨nh t·ªëi thi·ªÉu Ram 1GB, b·ªô nh·ªõ tr·ªëng 2,5 GB - C√†i s·∫µn Docker, c·∫•u h√¨nh c√†ng cao cho tr·∫£i nghi·ªám t·ªët h∆°n.
>
## IV.Danh s√°ch t√≠nh nƒÉng ‚ú®
### ƒê√£ th·ª±c hi·ªán ‚úÖ
| Giao di·ªán ph√°t nh·∫°c tr·ª±c ti·∫øp tr√™n tr√¨nh duy·ªát PCC ho·∫∑c Mobile|
| M√£ ho√° json ch·∫°y tr√™n Firrmware c·ªßa thi·∫øt b·ªã ESP32 Xiaozhi |
| Ngu·ªìn nh·∫°c ch√≠nh th·ªëng t·ª´ server Zing Mp3 - th∆∞·ªùng xuy√™n Update |
| CB·∫£o m·∫≠t IP thi·∫øt b·ªã tr√°nh b·ªã l·ªô IP khi d√πng chung nhi·ªÅu thi·∫øt b·ªã |
| Ho√†n to√†n mi·ªÖn ph√≠ |
### ƒêang ph√°t tri·ªÉn üö©
| Giao di·ªán ph√°t nh·∫°c theo danh s√°ch Playlist|

### V.C√°c b∆∞·ªõc th·ª±c hi·ªán üöß

<b>***PP1*** Ph∆∞∆°ng ph√°p c√†i t·ª´ Th·∫ª nh·ªõ, USB:</b>
- B∆∞·ªõc 1 : Truy c·∫≠p <a href="https://github.com/ledienbien-ai/DB-zingmp3-servermusic"> DB-zingmp3-servermusic</a>. Ch·ªçn Code - Download zip - gi·∫£i n√©n DB-zingmp3-servermusic - Copy v√†o th·∫ª nh·ªõ, USB.
- B∆∞·ªõc 2 : C·∫Øm usb v√†o thi·∫øt b·ªã Armbian . SSH v√†o Armbian v√† ki·ªÉm tra th∆∞ m·ª•c ch·ª©a d·ª± √°n
```bash
df -h
```
Ho·∫∑c
```bash
lsblk
```
1. T·∫°o th∆∞ m·ª•c ƒë·ªÉ g·∫Øn USB
B·∫°n c·∫ßn t·∫°o m·ªôt th∆∞ m·ª•c tr·ªëng ƒë√≥ng vai tr√≤ l√†m "c·ª≠a ng√µ" ƒë·ªÉ truy c·∫≠p USB. Ch·∫°y l·ªánh sau:

```bash
sudo mkdir -p /mnt/usb
```
2. Mount (g·∫Øn) USB v√†o th∆∞ m·ª•c v·ª´a t·∫°o
V√¨ lsblk ch·ªâ hi·ªán sda m√† kh√¥ng c√≥ ph√¢n v√πng con (nh∆∞ sda1), d·ªØ li·ªáu c·ªßa b·∫°n c√≥ th·ªÉ n·∫±m tr·ª±c ti·∫øp tr√™n to√†n b·ªô ·ªï ƒëƒ©a. Ch·∫°y l·ªánh:

```bash
sudo mount /dev/sda /mnt/usb
```
(N·∫øu h·ªá th·ªëng y√™u c·∫ßu m·∫≠t kh·∫©u, h√£y nh·∫≠p m·∫≠t kh·∫©u c·ªßa user armbian).

3. Ki·ªÉm tra d·ªØ li·ªáu v√† ch·∫°y Server
N·∫øu l·ªánh mount th√†nh c√¥ng v√† kh√¥ng b√°o l·ªói g√¨, USB c·ªßa b·∫°n ƒë√£ s·∫µn s√†ng.

Ki·ªÉm tra xem th∆∞ m·ª•c DB-zingmp3-servermusic ƒë√£ xu·∫•t hi·ªán ch∆∞a:

```bash
ls /mnt/usb
```
Di chuy·ªÉn v√†o th∆∞ m·ª•c ƒë√≥:

```bash
cd /mnt/usb/DB-zingmp3-servermusic
```
Kh·ªüi ch·∫°y Docker:

```bash
docker compose up -d
```
 *Note: C√°c b·∫°n ki√™n nh·∫´n ƒë·ª£i d·ª± √°n tri·ªÉn khai v√† c√†i c√°c th∆∞ vi·ªán ƒëi k√®m v√† b·∫≠t Container trong Docker: Qu√° tr√¨nh nhanh hay ch·∫≠m ph·ª• thu·ªôc ph·∫ßn c·ª©ng v√† t·ªëc ƒë·ªô m·∫°ng c·ªßa b·∫°n. <br>
4. T·∫°o m·∫°ng xiaozhi-network ƒë·ªÉ kh·ªüi ch·∫°y server:
```bash
docker network create xiaozhi-network
```
5. Ki·ªÉm tra v√† test th·ª≠ Server:
Truy c·∫≠p m√°y ch·ªß theo ƒë∆∞·ªùng d·∫´n:
```bash
http:/localhost:5001 
```
ho·∫∑c 
```bash
http://IP Armbian:5001
```
***PP2*** Ph∆∞∆°ng ph√°p tri·ªÉn khai tr·ª±c ti·∫øp trong Docker:
1. T·∫°o th∆∞ m·ª•c v√† file c·∫•u h√¨nh, c√°c b·∫°n h√£y ch·∫°y c√°c l·ªánh sau tr√™n terminal ƒë·ªÉ t·∫°o m·ªôt th∆∞ m·ª•c m·ªõi:

```bash
sudo mkdir -p /mnt/usb/DB-zingmp3-servermusic
```
```bash
cd /mnt/usb/DB-zingmp3-servermusic
```
2. T·∫°o file Dockerfile
Ch·∫°y 
```bash
sudo nano Dockerfile 
```
v√† d√°n n·ªôi dung sau:

```bash
# DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#=======================================================
FROM python:3.10
RUN apt-get update && apt-get install -y ffmpeg && rm -rf /var/lib/apt/lists/*
WORKDIR /app
COPY requirements.txt .
RUN pip install --upgrade pip
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "app.py"]

# End - DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#============================================================
```

(L∆∞u l·∫°i b·∫±ng Ctrl+O -> Enter -> Ctrl+X)

3. T·∫°o file requirements.txt
Ch·∫°y 
```bash
sudo nano requirements.txt
```
 v√† d√°n:

```bash
# DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#=======================================================

Flask==3.0.0
flask-cors==4.0.0
psutil==5.9.6
requests

# End - DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#============================================================
```

4. T·∫°o file docker-compose.yml
Ch·∫°y 
```bash
sudo nano docker-compose.yml
```

 v√† d√°n c·∫•u h√¨nh n√†y (l∆∞u √Ω c·ªïng l√† 5001:5000 v√† k·∫øt n·ªëi c√πng m·∫°ng xiaozhi-network):

```bash
# DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#=======================================================
services:
  zingmp3-server:
    build: .
    container_name: zingmp3-server
    restart: unless-stopped
    ports:
      - "5001:5000"
    networks:
      - xiaozhi-network
    volumes:
      - .:/app
    depends_on:
      - zing-api

  zing-api:
    image: node:18-alpine
    container_name: zing-api
    restart: unless-stopped
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "npm install zingmp3-api-full express && node zing-api.js"
    networks:
      - xiaozhi-network
    ports:
      - "5555:5555"

networks:
  xiaozhi-network:
    external: true
    
# End - DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#============================================================
```
5. T·∫°o file API Node.js v√†o th∆∞ m·ª•c d·ª± √°n
Ch·∫°y 
```bash
sudo nano zing-api.js
```
D√°n n·ªôi dung:

```bash
// DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
//=======================================================
const { ZingMp3 } = require("zingmp3-api-full");
const express = require("express");
const app = express();
const PORT = 5555;

// API T√¨m ki·∫øm
app.get("/api/search", async (req, res) => {
    try {
        const q = req.query.q;
        console.log(`üîç [API 5555] ƒêang t√¨m: ${q}`);
        const data = await ZingMp3.search(q);
        res.json(data);
    } catch (err) {
        res.status(500).json({ error: err.message });
    }
});

// API L·∫•y link nh·∫°c
app.get("/api/song", async (req, res) => {
    try {
        const id = req.query.id;
        console.log(`üéµ [API 5555] L·∫•y link ID: ${id}`);
        const data = await ZingMp3.getSong(id);
        res.json(data);
    } catch (err) {
        res.status(500).json({ error: err.message });
    }
});

app.listen(PORT, () => {
    console.log(`‚úÖ Zing API Backend ƒëang ch·∫°y t·∫°i http://0.0.0.0:${PORT}`);
});
// End - DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
//============================================================
```

6. T·∫°o file app.py (M√£ ngu·ªìn ch√≠nh): <br>
Ch·∫°y :
```bash
sudo nano app.py
```
v√† d√°n to√†n b·ªô ƒëo·∫°n code d∆∞·ªõi ƒë√¢y:

```bash
# DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#=======================================================
import logging
import time
import subprocess
import psutil
import urllib.parse
import requests
from flask import Flask, request, Response, jsonify
from flask_cors import CORS
from datetime import datetime

# C·∫•u h√¨nh Log
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

app = Flask(__name__)
CORS(app)

audio_cache = {}
access_logs = []

# Backend URL 5555 ƒë·ªÉ l·∫•y th√¥ng tin b√†i h√°t:
BACKEND_URL = 'http://zing-api:5555'

def mask_ip(ip):
    try:
        parts = ip.split('.')
        if len(parts) == 4:
            return f"{parts[0]}.{parts[1]}.{parts[2]}.xxx"
        return "xxx.xxx.xxx.xxx"
    except: return ip

def add_log(ip, action, song_id="-", song="", artist="", type='info'):
    now = datetime.now().strftime("%H:%M:%S")
    masked_ip = mask_ip(ip)
    access_logs.insert(0, {
        "time": now, "ip": masked_ip, "action": action, 
        "song_id": song_id, "song": song, "artist": artist, "type": type
    })
    if len(access_logs) > 30: access_logs.pop()

@app.route('/api/sys_stats')
def sys_stats():
    return jsonify({
        "cpu": psutil.cpu_percent(),
        "ram": psutil.virtual_memory().percent,
        "disk": psutil.disk_usage('/').percent,
        "net_sent": round(psutil.net_io_counters().bytes_sent / (1024 * 1024), 2),
        "logs": access_logs
    })

@app.route('/api/clear_logs', methods=['POST'])
def clear_logs_api():
    access_logs.clear()
    return jsonify({"success": True})

@app.route('/stream_pcm')
def api_get_info_json():
    song = request.args.get('song', '')
    if not song: return jsonify({"error": "Missing query"}), 400
    
    # 1. G·ªçi backend 5555 ƒë·ªÉ l·∫•y th√¥ng tin b√†i h√°t:
    try:
        sRes = requests.get(f"{BACKEND_URL}/api/search?q={urllib.parse.quote(song)}", timeout=10).json()
        songs_data = sRes.get('data', {}).get('songs', [])
        if not songs_data:
            add_log(request.remote_addr, "L·ªñI T√åM", type="error")
            return jsonify({"error": "Kh√¥ng t√¨m th·∫•y b√†i h√°t tr√™n ZingMP3"}), 404
            
        song_info = songs_data[0]
        song_id = song_info.get('encodeId')
        title = song_info.get('title')
        artist = song_info.get('artistsNames', 'Unknown')
        thumb = song_info.get('thumbnailM') or song_info.get('thumbnail')
    except Exception as e:
        logger.error(f"L·ªói k·∫øt n·ªëi Backend 5555 Search: {e}")
        return jsonify({"error": "L·ªói k·∫øt n·ªëi API 5555"}), 500

    current_time = time.time()
    
    # 2. G·ªçi backend 5555 ƒë·ªÉ l·∫•y Link Audio Stream:
    if song_id not in audio_cache or (current_time - audio_cache[song_id]['timestamp'] > 1800):
        try:
            lRes = requests.get(f"{BACKEND_URL}/api/song?id={song_id}", timeout=10).json()
            data = lRes.get('data', {})
            
            real_url = data.get('128') or lRes.get('url')
            if not real_url:
                add_log(request.remote_addr, "L·ªñI VIP", song_id=song_id, song=title, artist=artist, type="error")
                return jsonify({"error": "Kh√¥ng l·∫•y ƒë∆∞·ª£c link nh·∫°c (B√†i VIP ho·∫∑c l·ªói Session)"}), 403
                
            real_url = real_url.replace('http:', 'https:')
            audio_cache[song_id] = {'url': real_url, 'timestamp': current_time, 'title': title, 'artist': artist}
        except Exception as e:
            logger.error(f"L·ªói l·∫•y link Audio API 5555: {e}")
            return jsonify({"error": "L·ªói gi·∫£i m√£ lu·ªìng nh·∫°c"}), 500

    add_log(request.remote_addr, "T√¨m ki·∫øm", song_id=song_id, song=title, artist=artist, type="success")
    return jsonify({"success": True, "title": title, "artist": artist, "thumbnail": thumb, "audio_url": f"/stream_mp3?id={song_id}"})

@app.route('/stream_mp3')
def api_stream_audio():
    song_id = request.args.get('id')
    cached = audio_cache.get(song_id)
    if not cached: return "Expired", 404
    
    add_log(request.remote_addr, "ƒêang ph√°t", song_id=song_id, song=cached['title'], artist=cached['artist'], type="info")
    
    # C·∫•u h√¨nh FFMPEG m√¥ ph·ªèng tr√¨nh duy·ªát:
    ffmpeg_cmd = [
        'ffmpeg', '-reconnect', '1', '-reconnect_streamed', '1', 
        '-user_agent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        '-headers', 'Referer: https://zingmp3.vn/\r\n',
        '-i', cached['url'], 
        '-ac', '2', '-ar', '44100', '-b:a', '128k', '-f', 'mp3', '-'
    ]
    
    def generate():
        process = subprocess.Popen(ffmpeg_cmd, stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)
        try:
            while True:
                chunk = process.stdout.read(8192)
                if not chunk: break
                yield chunk
        finally: process.kill()
    return Response(generate(), mimetype='audio/mpeg', headers={'Access-Control-Allow-Origin': '*'})

@app.route('/')
def home():
    return """
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"><title>DB Music Server</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&family=Montserrat:wght@700&display=swap');
        :root { --neon-purple: #b026ff; --neon-pink: #ff26b9; --bg-dark: #090314; --card-bg: rgba(25, 10, 45, 0.7); }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg-dark); background-image: radial-gradient(circle at 50% 0%, rgba(176, 38, 255, 0.15) 0%, transparent 50%); color: #e2e8f0; min-height: 100vh; }
        .rotating { animation: rotate 15s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .card-dark { background: var(--card-bg); border: 1px solid rgba(176, 38, 255, 0.3); border-radius: 1.5rem; backdrop-filter: blur(10px); box-shadow: 0 0 20px rgba(176, 38, 255, 0.15), inset 0 0 15px rgba(176, 38, 255, 0.05); }
        .stat-val { font-family: 'Fira Code', monospace; text-shadow: 0 0 10px currentColor; }
        .log-line { font-family: 'Fira Code', monospace; font-size: 11px; display: grid; grid-template-columns: 75px 110px 85px 100px 1.5fr 1fr; gap: 10px; padding: 6px 10px; border-bottom: 1px solid rgba(176, 38, 255, 0.2); align-items: center; }
        .header-title { font-size: 2.5rem; letter-spacing: 0.2rem; background: linear-gradient(to right, #c084fc, #e879f9, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 8px rgba(232, 121, 249, 0.5)); }
        .btn-neon { background: linear-gradient(45deg, var(--neon-purple), var(--neon-pink)); box-shadow: 0 0 15px rgba(176, 38, 255, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .btn-neon:hover { box-shadow: 0 0 25px rgba(255, 38, 185, 0.6), 0 0 10px rgba(176, 38, 255, 0.8); transform: scale(1.05); }
        .input-neon { background: rgba(10, 5, 20, 0.8); border: 1px solid rgba(176, 38, 255, 0.4); transition: all 0.3s ease; color: #fff; }
        .input-neon:focus { outline: none; border-color: var(--neon-pink); box-shadow: 0 0 15px rgba(255, 38, 185, 0.4), inset 0 0 5px rgba(255, 38, 185, 0.2); }
        .disc-neon { border-color: #2d1b4e; box-shadow: 0 0 30px rgba(176, 38, 255, 0.3); }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center gap-6">
    <div class="text-center mt-4 mb-2">
        <h1 class="header-title font-black uppercase italic">DB ZINGMP3 SERVER</h1>
        <div class="h-1 w-32 mx-auto rounded-full mt-2 opacity-70" style="background: linear-gradient(to right, #b026ff, #ff26b9); box-shadow: 0 0 10px #ff26b9;"></div>
    </div>
    
    <div class="card-dark p-6 w-full max-w-4xl flex flex-col gap-6">
        <div class="flex flex-col md:flex-row items-center gap-8 border-b border-purple-900/50 pb-6">
            <div id="discWrapper" class="disc-neon relative w-40 h-40 rounded-full border-[6px] overflow-hidden bg-black flex items-center justify-center shrink-0">
                <div id="songThumb" class="absolute inset-0 bg-cover bg-center opacity-70" style="background-image: url('https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=300');"></div>
                <div class="w-8 h-8 rounded-full z-20 border-4 border-purple-900" style="background: #090314;"></div>
            </div>
            <div class="text-center md:text-left w-full overflow-hidden">
                <h2 id="title" class="text-2xl font-bold text-white truncate drop-shadow-md">K·∫øt n·ªëi ZingMP3 th√†nh c√¥ng</h2>
                <p id="artist" class="text-fuchsia-400 font-semibold mb-6" style="text-shadow: 0 0 5px rgba(232, 121, 249, 0.5);">M·ªùi nh·∫≠p t√™n b√†i h√°t</p>
                <div class="flex gap-2">
                    <input type="text" id="songInput" onkeypress="if(event.key==='Enter')handleSearch()" placeholder="Nh·∫≠p t√™n b√†i h√°t ZingMP3..." class="input-neon px-5 py-3 rounded-xl w-full text-sm placeholder-purple-300/50">
                    <button onclick="handleSearch()" class="btn-neon text-white px-8 rounded-xl font-bold uppercase text-xs tracking-tighter shrink-0">T√¨m ki·∫øm</button>
                </div>
            </div>
        </div>
        
        <canvas id="visualizerCanvas" class="w-full h-24 bg-black/30 rounded-xl border border-purple-900/30 shadow-[inset_0_0_10px_rgba(0,0,0,0.5)]"></canvas>
        
        <div class="flex justify-center">
            <button id="playBtn" onclick="handlePlay()" class="btn-neon text-white px-14 py-4 rounded-2xl font-bold flex items-center gap-3 uppercase text-xs tracking-widest shadow-lg">
                <i class="fas fa-play-circle text-2xl"></i> PH√ÅT NH·∫†C
            </button>
        </div>
    </div>

    <div class="card-dark p-5 w-full max-w-4xl flex flex-col gap-5">
        <div class="grid grid-cols-4 gap-4 text-center py-2 border-b border-purple-900/50">
            <div><p class="text-[10px] text-blue-400 font-bold uppercase tracking-wider">CPU</p><p id="cpu-v" class="stat-val text-lg text-blue-400">0%</p></div>
            <div><p class="text-[10px] text-emerald-400 font-bold uppercase tracking-wider">RAM</p><p id="ram-v" class="stat-val text-lg text-emerald-400">0%</p></div>
            <div><p class="text-[10px] text-orange-400 font-bold uppercase tracking-wider">DISK</p><p id="disk-v" class="stat-val text-lg text-orange-400">0%</p></div>
            <div><p class="text-[10px] text-rose-400 font-bold uppercase tracking-wider">TRAFFIC</p><p id="net-v" class="stat-val text-lg text-rose-400">0MB</p></div>
        </div>
        <div class="h-20 bg-black/40 rounded-xl overflow-hidden border border-purple-900/30"><canvas id="cpuChart"></canvas></div>
        
        <div class="flex flex-col gap-2">
            <div class="flex flex-col bg-black/50 rounded-xl overflow-hidden border border-purple-900/40">
                <div class="log-line font-bold bg-purple-900/30 text-[10px] text-purple-200 uppercase tracking-wider border-b border-purple-800/50">
                    <span>GI·ªú</span><span>IP TRUY C·∫¨P</span><span>H√ÄNH ƒê·ªòNG</span><span>ID ZING</span><span>B√ÄI H√ÅT</span><span>CA S·ª∏</span>
                </div>
                <div id="logList" class="h-56 overflow-y-auto flex flex-col scrollbar-thin scrollbar-thumb-purple-600 scrollbar-track-transparent">
                    <div class="p-4 text-center text-purple-400/50 italic text-sm">Ch·ªù d·ªØ li·ªáu...</div>
                </div>
            </div>
            <button onclick="clearLogs()" class="self-end text-purple-400 hover:text-pink-400 transition text-[10px] font-bold flex items-center gap-2 px-4 py-2 bg-purple-900/20 hover:bg-pink-900/30 rounded-lg mt-1 border border-purple-700/50 hover:border-pink-500/50 shadow-[0_0_10px_rgba(176,38,255,0.1)] hover:shadow-[0_0_10px_rgba(255,38,185,0.3)]">
                <i class="fas fa-trash"></i> X√≥a Logs
            </button>
        </div>
    </div>

    <div class="card-dark p-4 w-full max-w-4xl flex flex-col gap-2 border border-red-900/30 bg-red-900/10 rounded-xl">
        <h3 class="text-[11px] font-bold text-red-400/80 uppercase tracking-widest text-center flex items-center justify-center gap-2">
            <i class="fas fa-exclamation-triangle"></i> Tuy√™n b·ªë mi·ªÖn tr·ª´ tr√°ch nhi·ªám
        </h3>
        <p class="text-[10px] text-gray-400/80 leading-relaxed text-justify px-2">
            Server s·ª≠ d·ª•ng ngu·ªìn d·ªØ li·ªáu v√† b√†i h√°t t·ª´ Zing MP3. M·ªçi b·∫£n quy·ªÅn t√°c ph·∫©m √¢m nh·∫°c, h√¨nh ·∫£nh v√† th√¥ng tin li√™n quan ho√†n to√†n thu·ªôc v·ªÅ Zing MP3 v√† c√°c ƒë∆°n v·ªã ch·ªß qu·∫£n/t√°c gi·∫£. Nghi√™m c·∫•m s·ª≠ d·ª•ng m√£ ngu·ªìn v√† h·ªá th·ªëng n√†y cho m·ª•c ƒë√≠ch th∆∞∆°ng m·∫°i ho·∫∑c kinh doanh d∆∞·ªõi m·ªçi h√¨nh th·ª©c khi ch∆∞a c√≥ s·ª± cho ph√©p c·ªßa ƒë∆°n v·ªã ch·ªß qu·∫£n. M√£ ngu·ªìn n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi m·ª•c ƒë√≠ch h·ªçc t·∫≠p, nghi√™n c·ª©u c√° nh√¢n. Ch·ªß s·ªü h·ªØu m√£ ngu·ªìn s·∫µn s√†ng g·ª° b·ªè m·ªçi t√°c quy·ªÅn v√† d·ª´ng ho·∫°t ƒë·ªông n·∫øu c√≥ y√™u c·∫ßu t·ª´ ƒë∆°n v·ªã s·ªü h·ªØu b·∫£n quy·ªÅn, ƒë·ªìng th·ªùi tuy√™n b·ªë mi·ªÖn tr·ª´ m·ªçi tr√°ch nhi·ªám ph√°p l√Ω li√™n quan ƒë·∫øn vi·ªác ng∆∞·ªùi d√πng s·ª≠ d·ª•ng n·ªÅn t·∫£ng n√†y.
        </p>
    </div>

    <div class="card-dark p-5 w-full max-w-4xl flex flex-col gap-5">
        <div class="text-center py-2">
            <p class="text-[11px] text-purple-300 font-bold uppercase tracking-widest drop-shadow-md">
                Design&Dev : L√™ ƒêi·ªán Bi√™n - <a href="https://zalo.me/0915468863" target="_blank"> Zalo Me </a> - Email: ledienbien@gmail.com - Xiaozhi IoT VN
            </p>
        </div>
    </div>
    
    <audio id="audioPlayer" crossorigin="anonymous"></audio>
    
    <script>
        const audio = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const disc = document.getElementById('discWrapper');
        const canvas = document.getElementById('visualizerCanvas');
        const ctx = canvas.getContext('2d');
        let audioCtx, analyser, dataArray;

        function draw() {
            requestAnimationFrame(draw);
            if (!analyser) return;
            analyser.getByteFrequencyData(dataArray);
            canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
            const barWidth = (canvas.width / dataArray.length) * 1.5;
            let x = 0; ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < dataArray.length; i++) {
                const barHeight = (dataArray[i] / 255) * canvas.height;
                const hue = i * (360 / dataArray.length); 
                const gradient = ctx.createLinearGradient(0, canvas.height, 0, canvas.height - barHeight);
                gradient.addColorStop(0, `hsla(${hue}, 100%, 50%, 1)`);
                gradient.addColorStop(1, `hsla(${hue}, 100%, 70%, 0.3)`);
                ctx.fillStyle = gradient; 
                ctx.shadowBlur = 10;
                ctx.shadowColor = `hsla(${hue}, 100%, 50%, 0.7)`;
                ctx.fillRect(x, canvas.height - barHeight, barWidth - 2, barHeight);
                x += barWidth;
                ctx.shadowBlur = 0;
            }
        }

        async function handleSearch() {
            const q = document.getElementById('songInput').value;
            if(!q) return;
            document.getElementById('title').innerText = "ƒêang l·∫•y t·ª´ Backend 555...";
            try {
                const res = await fetch(`/stream_pcm?song=${encodeURIComponent(q)}`);
                const data = await res.json();
                if(data.success) {
                    document.getElementById('title').innerText = data.title;
                    document.getElementById('artist').innerText = data.artist;
                    document.getElementById('songThumb').style.backgroundImage = `url('${data.thumbnail}')`;
                    audio.src = data.audio_url; audio.load();
                    disc.classList.remove('rotating');
                    playBtn.innerHTML = '<i class="fas fa-play-circle text-xl"></i> PH√ÅT NH·∫†C';
                } else if(data.error) {
                    document.getElementById('title').innerText = data.error;
                }
            } catch(e) { document.getElementById('title').innerText = "L·ªói k·∫øt n·ªëi!"; }
        }

        function handlePlay() {
            if(!audio.src) return;
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                const source = audioCtx.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioCtx.destination);
                analyser.fftSize = 128; dataArray = new Uint8Array(analyser.frequencyBinCount);
                draw();
            }
            if(audioCtx.state === 'suspended') audioCtx.resume();
            if(audio.paused) {
                audio.play(); disc.classList.add('rotating');
                playBtn.innerHTML = '<i class="fas fa-pause-circle text-xl"></i> T·∫†M D·ª™NG';
            } else {
                audio.pause(); disc.classList.remove('rotating');
                playBtn.innerHTML = '<i class="fas fa-play-circle text-xl"></i> TI·∫æP T·ª§C';
            }
        }

        async function clearLogs() {
            if(!confirm("B·∫°n c√≥ mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ log?")) return;
            try { await fetch('/api/clear_logs', { method: 'POST' });
                document.getElementById('logList').innerHTML = '<div class="p-4 text-center text-purple-400/50 italic text-sm">Logs ƒë√£ ƒë∆∞·ª£c d·ªçn s·∫°ch.</div>';
            } catch(e) {}
        }

        const chartCtx = document.getElementById('cpuChart').getContext('2d');
        const cpuChart = new Chart(chartCtx, {
            type: 'line',
            data: { 
                labels: Array(20).fill(''), 
                datasets: [{ 
                    data: Array(20).fill(0), 
                    borderColor: '#f472b6', 
                    tension: 0.4, 
                    fill: true, 
                    backgroundColor: 'rgba(244, 114, 182, 0.15)', 
                    pointRadius: 0,
                    borderWidth: 2
                }] 
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 100, display: false }, x: { display: false } } }
        });

        async function updateStats() {
            try {
                const res = await fetch('/api/sys_stats');
                const d = await res.json();
                document.getElementById('cpu-v').innerText = d.cpu + '%';
                document.getElementById('ram-v').innerText = d.ram + '%';
                document.getElementById('disk-v').innerText = (100 - d.disk).toFixed(0) + '%';
                document.getElementById('net-v').innerText = d.net_sent + 'MB';
                cpuChart.data.datasets[0].data.shift(); cpuChart.data.datasets[0].data.push(d.cpu); cpuChart.update('none');
                
                const logList = document.getElementById('logList');
                if (d.logs.length === 0) {
                    logList.innerHTML = '<div class="p-4 text-center text-purple-400/50 italic text-sm">Ch∆∞a c√≥ d·ªØ li·ªáu...</div>';
                } else {
                    logList.innerHTML = d.logs.map(l => {
                        const color = l.type === 'success' ? 'text-emerald-400' : (l.type === 'error' ? 'text-red-400' : 'text-blue-400');
                        return `<div class="log-line">
                            <span class="text-slate-400">${l.time}</span><span class="text-slate-500 italic">${l.ip}</span>
                            <span class="${color} font-bold drop-shadow-sm">${l.action}</span><span class="text-blue-300 font-mono text-[10px] truncate">${l.song_id || '-'}</span>
                            <span class="text-white truncate font-medium">${l.song || ''}</span><span class="text-slate-400 truncate text-[10px]">${l.artist || ''}</span>
                        </div>`;
                    }).join('');
                }
            } catch(e) {}
        }
        setInterval(updateStats, 2000);
    </script>
    <footer></footer>
</body>
</html>
"""

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, threaded=True)

# End - DIENBIEN MOD - Server nh·∫°c Zing MP3 ch·∫°y tr√™n Armbian
#============================================================
```
6. Kh·ªüi ch·∫°y Server ZingMP3: <br>
Cu·ªëi c√πng, c√°c b·∫°n ch·∫°y l·ªánh sau ƒë·ªÉ Docker t·∫£i th∆∞ vi·ªán v√† kh·ªüi ch·∫°y:

```bash
sudo docker compose up -d --build
```
 *Note: C√°c b·∫°n ki√™n nh·∫´n ƒë·ª£i d·ª± √°n tri·ªÉn khai v√† c√†i c√°c th∆∞ vi·ªán ƒëi k√®m v√† b·∫≠t Container trong Docker: Qu√° tr√¨nh nhanh hay ch·∫≠m ph·ª• thu·ªôc ph·∫ßn c·ª©ng v√† t·ªëc ƒë·ªô m·∫°ng c·ªßa b·∫°n. <br>
7. T·∫°o m·∫°ng xiaozhi-network ƒë·ªÉ kh·ªüi ch·∫°y server:
```bash
docker network create xiaozhi-network
```
8. Ki·ªÉm tra v√† test th·ª≠ Server:
Truy c·∫≠p m√°y ch·ªß theo ƒë∆∞·ªùng d·∫´n:
```bash
http:/localhost:5001 
```
ho·∫∑c 
```bash
http://IP Armbian:5001
```
Ch√∫c c√°c b·∫°n tri·ªÉn khai th√†nh c√¥ng !
---


## VI.L·ªùi c·∫£m ∆°n üôè

| Logo | D·ª± √°n/C√¥ng ty | M√¥ t·∫£ |
|:---:|:---:|:---|
| D·ª± √°n n√†y ƒë∆∞·ª£c l·∫•y c·∫£m h·ª©ng t·ª´ s·ª≠ d·ª•ng giao di·ªán c·ªßa b·∫°n Duy B·∫±ng v√† ƒë∆∞·ª£c tri·ªÉn khai tr√™n c∆° s·ªü ƒë√≥ | Thanks | Note |
| D·ª± √°n n√†y ho√†n to√†n mi·ªÖn ph√≠ v√† chia s·∫ª r·ªông r√£i, kh√¥ng s·ª≠ d·ª•ng ƒë·ªÉ kinh doanh n·∫øu ch∆∞a h·ªèi √Ω ki·∫øn c·ªßa t√¥i  | Thanks | Note |
| Ghi r√µ ngu·ªìn n·∫øu s·ª≠ d·ª•ng l·∫°i | Thanks | Note |

![Banners](./Zing.JPG)

<a href="https://star-history.com/#ledienbien-ai/DB-zingmp3-servermusic&Date">

 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=ledienbien-ai/DB-zingmp3-servermusic&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=ledienbien-ai/DB-zingmp3-servermusic&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=ledienbien-ai/DB-zingmp3-servermusic&type=Date" />
 </picture>
</a>
